{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _helpers = require('../helpers');\n\nvar loadPage = function loadPage(data, popstate) {\n  var _this = this; // create array for storing animation promises\n\n\n  var animationPromises = [],\n      xhrPromise = void 0;\n\n  var animateOut = function animateOut() {\n    _this.triggerEvent('animationOutStart'); // handle classes\n\n\n    document.documentElement.classList.add('is-changing');\n    document.documentElement.classList.add('is-leaving');\n    document.documentElement.classList.add('is-animating');\n\n    if (popstate) {\n      document.documentElement.classList.add('is-popstate');\n    }\n\n    document.documentElement.classList.add('to-' + (0, _helpers.classify)(data.url)); // animation promise stuff\n\n    animationPromises = _this.getAnimationPromises('out');\n    Promise.all(animationPromises).then(function () {\n      _this.triggerEvent('animationOutDone');\n    }); // create history record if this is not a popstate call\n\n    if (!popstate) {\n      // create pop element with or without anchor\n      var state = void 0;\n\n      if (_this.scrollToElement != null) {\n        state = data.url + _this.scrollToElement;\n      } else {\n        state = data.url;\n      }\n\n      (0, _helpers.createHistoryRecord)(state);\n    }\n  };\n\n  this.triggerEvent('transitionStart', popstate); // set transition object\n\n  if (data.customTransition != null) {\n    this.updateTransition(window.location.pathname, data.url, data.customTransition);\n    document.documentElement.classList.add('to-' + (0, _helpers.classify)(data.customTransition));\n  } else {\n    this.updateTransition(window.location.pathname, data.url);\n  } // start/skip animation\n\n\n  if (!popstate || this.options.animateHistoryBrowsing) {\n    animateOut();\n  } else {\n    this.triggerEvent('animationSkipped');\n  } // start/skip loading of page\n\n\n  if (this.cache.exists(data.url)) {\n    xhrPromise = new Promise(function (resolve) {\n      resolve();\n    });\n    this.triggerEvent('pageRetrievedFromCache');\n  } else {\n    if (!this.preloadPromise || this.preloadPromise.route != data.url) {\n      xhrPromise = new Promise(function (resolve, reject) {\n        (0, _helpers.fetch)(_extends({}, data, {\n          headers: _this.options.requestHeaders\n        }), function (response) {\n          if (response.status === 500) {\n            _this.triggerEvent('serverError');\n\n            reject(data.url);\n            return;\n          } else {\n            // get json data\n            var page = _this.getPageData(response);\n\n            if (page != null) {\n              page.url = data.url;\n            } else {\n              reject(data.url);\n              return;\n            } // render page\n\n\n            _this.cache.cacheUrl(page);\n\n            _this.triggerEvent('pageLoaded');\n          }\n\n          resolve();\n        });\n      });\n    } else {\n      xhrPromise = this.preloadPromise;\n    }\n  } // when everything is ready, handle the outcome\n\n\n  Promise.all(animationPromises.concat([xhrPromise])).then(function () {\n    // render page\n    _this.renderPage(_this.cache.getPage(data.url), popstate);\n\n    _this.preloadPromise = null;\n  }).catch(function (errorUrl) {\n    // rewrite the skipPopStateHandling function to redirect manually when the history.go is processed\n    _this.options.skipPopStateHandling = function () {\n      window.location = errorUrl;\n      return true;\n    }; // go back to the actual page were still at\n\n\n    window.history.go(-1);\n  });\n};\n\nexports.default = loadPage;","map":{"version":3,"sources":["/home/wan/Dropbox/Projects/react_proj_chat_app/client/node_modules/swup/lib/modules/loadPage.js"],"names":["Object","defineProperty","exports","value","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_helpers","require","loadPage","data","popstate","_this","animationPromises","xhrPromise","animateOut","triggerEvent","document","documentElement","classList","add","classify","url","getAnimationPromises","Promise","all","then","state","scrollToElement","createHistoryRecord","customTransition","updateTransition","window","location","pathname","options","animateHistoryBrowsing","cache","exists","resolve","preloadPromise","route","reject","fetch","headers","requestHeaders","response","status","page","getPageData","cacheUrl","concat","renderPage","getPage","catch","errorUrl","skipPopStateHandling","history","go","default"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _helpers = require('../helpers');\n\nvar loadPage = function loadPage(data, popstate) {\n\tvar _this = this;\n\n\t// create array for storing animation promises\n\tvar animationPromises = [],\n\t    xhrPromise = void 0;\n\tvar animateOut = function animateOut() {\n\t\t_this.triggerEvent('animationOutStart');\n\n\t\t// handle classes\n\t\tdocument.documentElement.classList.add('is-changing');\n\t\tdocument.documentElement.classList.add('is-leaving');\n\t\tdocument.documentElement.classList.add('is-animating');\n\t\tif (popstate) {\n\t\t\tdocument.documentElement.classList.add('is-popstate');\n\t\t}\n\t\tdocument.documentElement.classList.add('to-' + (0, _helpers.classify)(data.url));\n\n\t\t// animation promise stuff\n\t\tanimationPromises = _this.getAnimationPromises('out');\n\t\tPromise.all(animationPromises).then(function () {\n\t\t\t_this.triggerEvent('animationOutDone');\n\t\t});\n\n\t\t// create history record if this is not a popstate call\n\t\tif (!popstate) {\n\t\t\t// create pop element with or without anchor\n\t\t\tvar state = void 0;\n\t\t\tif (_this.scrollToElement != null) {\n\t\t\t\tstate = data.url + _this.scrollToElement;\n\t\t\t} else {\n\t\t\t\tstate = data.url;\n\t\t\t}\n\n\t\t\t(0, _helpers.createHistoryRecord)(state);\n\t\t}\n\t};\n\n\tthis.triggerEvent('transitionStart', popstate);\n\n\t// set transition object\n\tif (data.customTransition != null) {\n\t\tthis.updateTransition(window.location.pathname, data.url, data.customTransition);\n\t\tdocument.documentElement.classList.add('to-' + (0, _helpers.classify)(data.customTransition));\n\t} else {\n\t\tthis.updateTransition(window.location.pathname, data.url);\n\t}\n\n\t// start/skip animation\n\tif (!popstate || this.options.animateHistoryBrowsing) {\n\t\tanimateOut();\n\t} else {\n\t\tthis.triggerEvent('animationSkipped');\n\t}\n\n\t// start/skip loading of page\n\tif (this.cache.exists(data.url)) {\n\t\txhrPromise = new Promise(function (resolve) {\n\t\t\tresolve();\n\t\t});\n\t\tthis.triggerEvent('pageRetrievedFromCache');\n\t} else {\n\t\tif (!this.preloadPromise || this.preloadPromise.route != data.url) {\n\t\t\txhrPromise = new Promise(function (resolve, reject) {\n\t\t\t\t(0, _helpers.fetch)(_extends({}, data, { headers: _this.options.requestHeaders }), function (response) {\n\t\t\t\t\tif (response.status === 500) {\n\t\t\t\t\t\t_this.triggerEvent('serverError');\n\t\t\t\t\t\treject(data.url);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// get json data\n\t\t\t\t\t\tvar page = _this.getPageData(response);\n\t\t\t\t\t\tif (page != null) {\n\t\t\t\t\t\t\tpage.url = data.url;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treject(data.url);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// render page\n\t\t\t\t\t\t_this.cache.cacheUrl(page);\n\t\t\t\t\t\t_this.triggerEvent('pageLoaded');\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\txhrPromise = this.preloadPromise;\n\t\t}\n\t}\n\n\t// when everything is ready, handle the outcome\n\tPromise.all(animationPromises.concat([xhrPromise])).then(function () {\n\t\t// render page\n\t\t_this.renderPage(_this.cache.getPage(data.url), popstate);\n\t\t_this.preloadPromise = null;\n\t}).catch(function (errorUrl) {\n\t\t// rewrite the skipPopStateHandling function to redirect manually when the history.go is processed\n\t\t_this.options.skipPopStateHandling = function () {\n\t\t\twindow.location = errorUrl;\n\t\t\treturn true;\n\t\t};\n\n\t\t// go back to the actual page were still at\n\t\twindow.history.go(-1);\n\t});\n};\n\nexports.default = loadPage;"]},"metadata":{},"sourceType":"script"}